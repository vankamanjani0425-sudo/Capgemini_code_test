<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">Monthly Premium Calculator</h3>
            <button type="button" class="btn btn-light btn-sm" (click)="onReset()">
              Reset
            </button>
          </div>
        </div>
        
        <div class="card-body p-4">
          @if (errorMessage) {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              {{ errorMessage }}
              <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
            </div>
          }

          <form [formGroup]="premiumForm" (ngSubmit)="onSubmit()" novalidate>
            <div class="row g-3">
              <!-- Name -->
              <div class="col-md-6">
                <label for="name" class="form-label">Full Name *</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  formControlName="name"
                  [class.is-invalid]="isFieldInvalid('name')"
                  placeholder="Enter your full name">
                @if (isFieldInvalid('name')) {
                  <div class="invalid-feedback">
                    {{ getFieldError('name') }}
                  </div>
                }
              </div>

              <!-- Age Next Birthday -->
              <div class="col-md-6">
                <label for="ageNextBirthday" class="form-label">Age Next Birthday *</label>
                <input
                  type="number"
                  class="form-control"
                  id="ageNextBirthday"
                  formControlName="ageNextBirthday"
                  [class.is-invalid]="isFieldInvalid('ageNextBirthday')"
                  min="18"
                  max="100"
                  placeholder="Enter your age">
                @if (isFieldInvalid('ageNextBirthday')) {
                  <div class="invalid-feedback">
                    {{ getFieldError('ageNextBirthday') }}
                  </div>
                }
              </div>

              <!-- Date of Birth -->
              <div class="col-md-6">
                <label for="dateOfBirth" class="form-label">Date of Birth *</label>
                <input
                  type="date"
                  class="form-control"
                  id="dateOfBirth"
                  formControlName="dateOfBirth"
                  [class.is-invalid]="isFieldInvalid('dateOfBirth')">
                @if (isFieldInvalid('dateOfBirth')) {
                  <div class="invalid-feedback">
                    {{ getFieldError('dateOfBirth') }}
                  </div>
                }
              </div>

              <!-- Occupation -->
              <div class="col-md-6">
                <label for="occupation" class="form-label">Occupation *</label>
                <select
                  class="form-select"
                  id="occupation"
                  formControlName="occupation"
                  [class.is-invalid]="isFieldInvalid('occupation')">
                  <option value="">Select your occupation</option>
                  @for (occupation of occupations; track occupation.id) {
                    <option [value]="occupation.name">
                      {{ occupation.name }}
                    </option>
                  }
                </select>
                @if (isFieldInvalid('occupation')) {
                  <div class="invalid-feedback">
                    {{ getFieldError('occupation') }}
                  </div>
                }
              </div>

              <!-- Death Sum Insured -->
              <div class="col-12">
                <label for="deathSumInsured" class="form-label">Death Sum Insured ($) *</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input
                    type="number"
                    class="form-control"
                    id="deathSumInsured"
                    formControlName="deathSumInsured"
                    [class.is-invalid]="isFieldInvalid('deathSumInsured')"
                    placeholder="Enter amount"
                    min="1000"
                    step="1000">
                </div>
                <div class="form-text">Minimum amount: $1,000</div>
                @if (isFieldInvalid('deathSumInsured')) {
                  <div class="invalid-feedback">
                    {{ getFieldError('deathSumInsured') }}
                  </div>
                }
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2 mt-4">
              <button
                type="submit"
                class="btn btn-primary btn-lg"
                [disabled]="isLoading || premiumForm.invalid">
                @if (isLoading) {
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Calculating...
                } @else {
                  Calculate Premium
                }
              </button>
            </div>
          </form>

          <!-- Premium Result -->
          @if (monthlyPremium > 0) {
            <div class="mt-4 p-4 bg-success bg-opacity-10 border border-success rounded">
              <div class="row align-items-center">
                <div class="col">
                  <h4 class="text-success mb-1">Monthly Premium</h4>
                  <p class="text-muted mb-0 small">{{ calculationDetails }}</p>
                </div>
                <div class="col-auto">
                  <h2 class="text-success mb-0">${{ monthlyPremium | number:'1.2-2' }}</h2>
                </div>
              </div>
            </div>
          }

          <!-- Form Status -->
          <div class="mt-3">
            <small class="text-muted">
              Form Status: 
              <span [class]="premiumForm.valid ? 'text-success' : 'text-danger'">
                {{ premiumForm.valid ? 'VALID' : 'INVALID' }}
              </span>
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>